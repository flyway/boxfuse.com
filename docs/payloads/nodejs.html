---
layout: docs
menu: nodejs
subtitle: 'Node.js'
---
<div id="war">
    <p><img src="/assets/img/nodejs.png"></p>

    <p>Boxfuse supports apps written in JavaScript or any other language and packaged as an <strong>.tgz file</strong> running on <strong>Node.js 5.7 or newer</strong>.</p>

    <h2>Get Started</h2>

    <p>If you haven't already, start by following <strong><a href="/getstarted/nodejs">Node.js &amp; Boxfuse tutorial</a></strong> that will get you <strong>up and running in 5-10 minutes</strong>.</p>

    <h2>Packaging</h2>

    <p>Applications should be packaged using with all dependencies marked as <code>bundledDependencies</code>.
        The easiest way to achieve this is to use <strong><a href="https://github.com/majgis/npm-bundle">npm-bundle</a></strong>.</p>

    <p>Start by installing <strong>npm-bundle</strong>:</p>

    <pre class="console"><span>&gt;</span> npm install -g npm-bundle</pre>

    <p>Make sure you shrinkwrap your project (this will create a <code>npm-shrinkwrap.json</code> file):</p>

    <pre class="console"><span>&gt;</span> npm shrinkwrap</pre>

    <p>Then simply create the <code>tgz</code> in the directory containing your <code>package.json</code>:</p>

    <pre class="console"><span>&gt;</span> npm-bundle</pre>

    <p>And finally fuse and run the Boxfuse image from that same directory:</p>

    <pre class="console"><span>&gt;</span> boxfuse run</pre>

    <h2 id="version">Node.js version</h2>

    <p>By default Boxfuse attempts to <strong>autodetect the Node.js version</strong> from the <code>engines</code> section in <code>package.json</code>.
        </p><p>If no fixed version is specified, Boxfuse falls back to the <strong>latest Node.js version</strong> (Current branch).
    </p><p>If you want to switch to an
        LTS release or simply a different version, you override this by using the <code><nobr>-components.nodejs</nobr></code> configuration setting:</p>

    <pre class="console"><span>&gt;</span> boxfuse run my-app-1.0.tgz <strong>-components.nodejs=</strong>8.2.1</pre>

    <h2>Ports</h2>

    <p>By Boxfuse configures your application's <code>http</code> port as well as the <code>PORT</code> environment variable to <code>80</code>.
        If your application has been generated by express it should pick this up automatically. Otherwise you need to adjust
        either your application or the Boxfuse ports configuration to match.</p>

    <h2 id="databases">Databases</h2>

    <h3>Database auto-provisioning</h3>

    <p>When using the <a href="/docs/databases">Boxfuse database auto-provisioning support</a>, Boxfuse automatically
        exposes your database's host, port, name, user and password for the current environment as environment variables.</p>

    <p>If your app includes the <strong><a href="https://github.com/brianc/node-postgres">pg</a></strong> or <strong><a href="https://github.com/felixge/node-mysql">mysql</a></strong> npm module, Boxfuse will automatically provision the necessary PostgreSQL or MySQL database
        in each environment.</p>

    <h3>Using an existing database</h3>
    <p>To disable database auto-provisioning and use an existing database set <code>db.type</code> to <code>none</code> when <a
            href="/docs/commandline/create#dbtype">creating your app</a>.</p>

    <h3>MySQL</h3>

    <p>To connect to your MySQL database you can use the following code:</p>

    <pre class="prettyprint">var mysql = require('mysql');
var connection = mysql.createConnection({
  host     : process.env.BOXFUSE_DATABASE_HOST,
  port     : process.env.BOXFUSE_DATABASE_PORT,
  user     : process.env.BOXFUSE_DATABASE_USER,
  password : process.env.BOXFUSE_DATABASE_PASSWORD,
  database : process.env.BOXFUSE_DATABASE_NAME,
  ssl      : process.env.BOXFUSE_DATABASE_CA_CERT,
  charset  : 'utf8mb4_unicode_ci',
  timezone : 'utc'
});
// Execute query</pre>

    <p>This also automatically ensures that all connections to RDS MySQL use TLS (SSL).</p>

    <h3>PostgreSQL</h3>

    <p>To connect to your PostgreSQL database you can use the following code:</p>

    <pre class="prettyprint">var pg = require('pg');
var fs = require('fs');

var connectionInfo = {
  host     : process.env.BOXFUSE_DATABASE_HOST,
  port     : process.env.BOXFUSE_DATABASE_PORT,
  user     : process.env.BOXFUSE_DATABASE_USER,
  password : process.env.BOXFUSE_DATABASE_PASSWORD,
  database : process.env.BOXFUSE_DATABASE_NAME
};
if (process.env.BOXFUSE_DATABASE_CA_CERT) {
  connectionInfo.ssl = {
    ca: [fs.readFileSync(process.env.BOXFUSE_DATABASE_CA_CERT, 'utf8')]
  };
}

var client = new pg.Client(connectionInfo);
client.connect(function(err) {
  // Execute query
});</pre>

    <p>This also automatically ensures that all connections to RDS PostgreSQL use TLS (SSL).</p>

    <h2 id="tls">TLS (SSL) Certificates / HTTPS</h2>

    <p>To expose your app via <strong>HTTPS</strong> make sure you have a <a href="/docs/domains">custom domain</a> configured
        for the <a href="/docs/environments">environment</a> where you want to run it. Also make sure that you have obtained
        a <a href="/docs/tls">valid TLS (SSL) certificate</a> and that your <a href="/docs/commandline/create">app has been created</a>
        with <code>app.type</code> set to <code>load-balanced</code> and <code>tls.type</code> set to <code>acm</code> (AWS Certificate Manager).</p>

    <p>To listen to the HTTPS port you can use the following code:</p>

    <pre class="prettyprint">var https = require('https');
var fs = require('fs');

var server = https.createServer({
    key: fs.readFileSync('/app-config/boxfuse-selfsigned-key.pem'),
    cert: fs.readFileSync('/app-config/boxfuse-selfsigned-cert.pem'),
    requestCert: false,
    rejectUnauthorized: false
}, app);
server.listen(443);</pre>

    <p>This will ensure that all network traffic between the ELB and your instances will be encrypted as well.</p>

    <h2 id="root-certificates">Root Certificates</h2>

    <p>Boxfuse uses the <strong>same root certificate bundle as the latest version of Firefox</strong>.
        Additionally Boxfuse also includes the <strong>root certificates for Amazon RDS</strong>, so you can connect securely to RDS databases out of the box.</p>

    <h2>Temporary Files</h2>

    <p>Boxfuse configures the JVM to use <code>/tmp</code> as the directory to store temporary files and provisions <strong>1 GB of space by default</strong>.</p>
    <p>To increase this (up to a maximum of 16 TB), simply set
        the <code>tmp</code> configuration setting to the number of GB of temp space you need. To prevent Boxfuse from
        provisioning any temp space set <code>tmp</code> to <code>0</code>.</p>

    <h2 id="debugging">Debugging</h2>
    <p>Remote debugging (including hot-code replace) with your favorite IDE is fully supported.
        Details and setup instructions on our <a href="/docs/debugging">debugging page</a>.</p>

    <h2 id="live">Live Reloading</h2>

    <p>In the <a href="/docs/environments">dev environment</a>, you can <a href="/docs/live">reload changes live</a> by running Boxfuse at the
    root of your Node.js project with <code>-live</code>:</p>

    <pre class="console">&gt; npm install
&gt; boxfuse run <strong>-live</strong></pre>

    <p>Also check out our <a href="/blog/live-reloading"><strong>blog post</strong></a> on how to
        reload Node.js application live on VirtualBox with Boxfuse.</p>

    <h2 id="timezone">Time Zone</h2>

    <p>By default all Boxfuse instance use the <strong><code>UTC</code> time zone</strong>.</p>

    <p>We <strong>don't recommend changing this</strong> as this greatly simplifies time zone issues in machine to machine communication
        and cleanly relegates all time zones related aspects to a pure presentation layer concern.</p>

    <p>If however you still do want to change this, you can override the default time zone of the instance using the
        <code>TZ</code> environment variable. For example to change the time zone of your instance to <code>America/Los_Angeles</code>
        you would do so like this:</p>

    <pre class="console"><span>&gt;</span> boxfuse fuse <strong>-envvars.TZ=</strong>America/Los_Angeles</pre>

    <h2 id="native">Native binaries and libs</h2>

    <p>Some Node.js applications also depend on <strong>native Linux x64 binaries and libs</strong> to do their work. Boxfuse makes it easy to
        integrate them into your image.</p>
    <p>Simply place your binaries under <code>/native/bin</code> inside your tgz and Boxfuse
        will automatically add them to the <code>PATH</code> at runtime in your instances.</p>

    <p>If those binaries also depend on additional shared libraries beyond the C library, place the .so files of your libraries
        under <code>/native/lib</code> inside your tgz and Boxfuse
        will automatically add them to the <code>LD_LIBRARY_PATH</code> at runtime in your instances.</p>

    <div class="alert alert-info"><p><strong>Tip</strong></p>
        <p>To list all the shared libraries your Linux x64 binary requires, you can use the following command on a Linux system:</p>
        <pre class="console" style="margin-bottom: 0"><span>$</span> ldd -v my-native-binary</pre>
    </div>

    <p>This effectively means the native binaries and libs should be under a <code>native</code> directory inside your application:</p>

    <pre class="filetree"><i class="fa fa-folder-open"></i> my-nodejs-app
  <i class="fa fa-file-text"></i> package.json
  <span><i class="fa fa-folder-open"></i> native
  <i class="fa fa-folder-open"></i> bin
    <i class="fa fa-file"></i> my-native-binary
    <i class="fa fa-file"></i> other-linux-x64-binary
  <i class="fa fa-folder-open"></i> lib
    <i class="fa fa-file"></i> my-shared-lib.so
    <i class="fa fa-file"></i> other-shared-lib.so</span></pre>

    <h2 id="kernel">Linux Kernel Tuning (experts only)</h2>

    <h3 id="kernelargs">Kernel arguments</h3>

    <p>To tune the arguments passed Linux kernel from the bootloader, simply pass them using the
        <a href="/docs/commandline/fuse#linux.args"><code>-linux.args</code></a> setting when fusing your image.</p>

    <h3 id="sysctl">sysctl.conf</h3>

    <p>If you need to tune the Linux kernel running in your instance, simply place a <code>sysctl.conf</code> file at the root inside your tgz file.
        This effectively means it should be in the root directory of your application:</p>
    <pre class="filetree"><i class="fa fa-folder-open"></i> my-nodejs-app
  <i class="fa fa-file-text"></i> package.json
  <span><i class="fa fa-file-text"></i> sysctl.conf</span></pre>

    <p>You can then for example tune the maximum number of file descriptors by simply including the following in <code>sysctl.conf</code>:</p>
    <pre class="prettyprint">fs.file-max = 131072</pre>

    <p>Boxfuse will then <strong>automatically configure the Linux kernel to use these settings</strong>.</p>

    <p class="next-steps">
        <a class="btn btn-primary" href="/docs/payloads/elf64">ELF64 Binaries <i class="fa fa-arrow-right"></i></a>
    </p>
</div>